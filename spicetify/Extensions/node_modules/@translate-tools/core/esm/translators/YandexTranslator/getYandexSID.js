// Source: https://github.com/FilipePS/Traduzir-paginas-web/blob/f3a4956a1aa96b7a9124864158a5200827694521/background/translationService.js
import axios from 'axios';
var lastYandexRequestSIDTime = null;
var yandexTranslateSID = null;
var yandexSIDNotFound = false;
export function getYandexSID() {
    return new Promise(function (resolve) {
        var updateYandexSid = false;
        if (lastYandexRequestSIDTime) {
            var date = new Date();
            if (yandexTranslateSID) {
                date.setHours(date.getHours() - 12);
            }
            else if (yandexSIDNotFound) {
                date.setMinutes(date.getMinutes() - 30);
            }
            else {
                date.setMinutes(date.getMinutes() - 2);
            }
            if (date.getTime() > lastYandexRequestSIDTime) {
                updateYandexSid = true;
            }
        }
        else {
            updateYandexSid = true;
        }
        if (updateYandexSid) {
            lastYandexRequestSIDTime = Date.now();
            var url = 'https://translate.yandex.net/website-widget/v1/widget.js?widgetId=ytWidget&pageLang=es&widgetTheme=light&autoMode=false';
            axios
                .get(url)
                .then(function (response) {
                var result = (typeof response.data === 'string' ? response.data : '').match(/sid\:\s\'[0-9a-f\.]+/);
                if (result && result[0] && result[0].length > 7) {
                    yandexTranslateSID = result[0].substring(6);
                    yandexSIDNotFound = false;
                }
                else {
                    yandexSIDNotFound = true;
                }
                resolve();
            })
                .catch(function (error) {
                console.error(error);
                resolve();
            });
        }
        else {
            resolve();
        }
    }).then(function () { return yandexTranslateSID; });
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zbGF0b3JzL1lhbmRleFRyYW5zbGF0b3IvZ2V0WWFuZGV4U0lELnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDBJQUEwSTtBQUUxSSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFFMUIsSUFBSSx3QkFBd0IsR0FBa0IsSUFBSSxDQUFDO0FBQ25ELElBQUksa0JBQWtCLEdBQWtCLElBQUksQ0FBQztBQUM3QyxJQUFJLGlCQUFpQixHQUFZLEtBQUssQ0FBQztBQUV2QyxNQUFNLFVBQVUsWUFBWTtJQUMzQixPQUFPLElBQUksT0FBTyxDQUFPLFVBQUMsT0FBTztRQUNoQyxJQUFJLGVBQWUsR0FBRyxLQUFLLENBQUM7UUFDNUIsSUFBSSx3QkFBd0IsRUFBRTtZQUM3QixJQUFNLElBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ3hCLElBQUksa0JBQWtCLEVBQUU7Z0JBQ3ZCLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO2FBQ3BDO2lCQUFNLElBQUksaUJBQWlCLEVBQUU7Z0JBQzdCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO2FBQ3hDO2lCQUFNO2dCQUNOLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO2FBQ3ZDO1lBQ0QsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsd0JBQXdCLEVBQUU7Z0JBQzlDLGVBQWUsR0FBRyxJQUFJLENBQUM7YUFDdkI7U0FDRDthQUFNO1lBQ04sZUFBZSxHQUFHLElBQUksQ0FBQztTQUN2QjtRQUVELElBQUksZUFBZSxFQUFFO1lBQ3BCLHdCQUF3QixHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUN0QyxJQUFNLEdBQUcsR0FDUix5SEFBeUgsQ0FBQztZQUUzSCxLQUFLO2lCQUNILEdBQUcsQ0FBQyxHQUFHLENBQUM7aUJBQ1IsSUFBSSxDQUFDLFVBQUMsUUFBUTtnQkFDZCxJQUFNLE1BQU0sR0FBRyxDQUNkLE9BQU8sUUFBUSxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FDdEQsQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztnQkFFaEMsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29CQUNoRCxrQkFBa0IsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUM1QyxpQkFBaUIsR0FBRyxLQUFLLENBQUM7aUJBQzFCO3FCQUFNO29CQUNOLGlCQUFpQixHQUFHLElBQUksQ0FBQztpQkFDekI7Z0JBRUQsT0FBTyxFQUFFLENBQUM7WUFDWCxDQUFDLENBQUM7aUJBQ0QsS0FBSyxDQUFDLFVBQUMsS0FBSztnQkFDWixPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNyQixPQUFPLEVBQUUsQ0FBQztZQUNYLENBQUMsQ0FBQyxDQUFDO1NBQ0o7YUFBTTtZQUNOLE9BQU8sRUFBRSxDQUFDO1NBQ1Y7SUFDRixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBTSxPQUFBLGtCQUFrQixFQUFsQixDQUFrQixDQUFDLENBQUM7QUFDbkMsQ0FBQyIsImZpbGUiOiJ0cmFuc2xhdG9ycy9ZYW5kZXhUcmFuc2xhdG9yL2dldFlhbmRleFNJRC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL0ZpbGlwZVBTL1RyYWR1emlyLXBhZ2luYXMtd2ViL2Jsb2IvZjNhNDk1NmExYWE5NmI3YTkxMjQ4NjQxNThhNTIwMDgyNzY5NDUyMS9iYWNrZ3JvdW5kL3RyYW5zbGF0aW9uU2VydmljZS5qc1xuXG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuXG5sZXQgbGFzdFlhbmRleFJlcXVlc3RTSURUaW1lOiBudW1iZXIgfCBudWxsID0gbnVsbDtcbmxldCB5YW5kZXhUcmFuc2xhdGVTSUQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xubGV0IHlhbmRleFNJRE5vdEZvdW5kOiBib29sZWFuID0gZmFsc2U7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRZYW5kZXhTSUQoKSB7XG5cdHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSkgPT4ge1xuXHRcdGxldCB1cGRhdGVZYW5kZXhTaWQgPSBmYWxzZTtcblx0XHRpZiAobGFzdFlhbmRleFJlcXVlc3RTSURUaW1lKSB7XG5cdFx0XHRjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcblx0XHRcdGlmICh5YW5kZXhUcmFuc2xhdGVTSUQpIHtcblx0XHRcdFx0ZGF0ZS5zZXRIb3VycyhkYXRlLmdldEhvdXJzKCkgLSAxMik7XG5cdFx0XHR9IGVsc2UgaWYgKHlhbmRleFNJRE5vdEZvdW5kKSB7XG5cdFx0XHRcdGRhdGUuc2V0TWludXRlcyhkYXRlLmdldE1pbnV0ZXMoKSAtIDMwKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGRhdGUuc2V0TWludXRlcyhkYXRlLmdldE1pbnV0ZXMoKSAtIDIpO1xuXHRcdFx0fVxuXHRcdFx0aWYgKGRhdGUuZ2V0VGltZSgpID4gbGFzdFlhbmRleFJlcXVlc3RTSURUaW1lKSB7XG5cdFx0XHRcdHVwZGF0ZVlhbmRleFNpZCA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHVwZGF0ZVlhbmRleFNpZCA9IHRydWU7XG5cdFx0fVxuXG5cdFx0aWYgKHVwZGF0ZVlhbmRleFNpZCkge1xuXHRcdFx0bGFzdFlhbmRleFJlcXVlc3RTSURUaW1lID0gRGF0ZS5ub3coKTtcblx0XHRcdGNvbnN0IHVybCA9XG5cdFx0XHRcdCdodHRwczovL3RyYW5zbGF0ZS55YW5kZXgubmV0L3dlYnNpdGUtd2lkZ2V0L3YxL3dpZGdldC5qcz93aWRnZXRJZD15dFdpZGdldCZwYWdlTGFuZz1lcyZ3aWRnZXRUaGVtZT1saWdodCZhdXRvTW9kZT1mYWxzZSc7XG5cblx0XHRcdGF4aW9zXG5cdFx0XHRcdC5nZXQodXJsKVxuXHRcdFx0XHQudGhlbigocmVzcG9uc2UpID0+IHtcblx0XHRcdFx0XHRjb25zdCByZXN1bHQgPSAoXG5cdFx0XHRcdFx0XHR0eXBlb2YgcmVzcG9uc2UuZGF0YSA9PT0gJ3N0cmluZycgPyByZXNwb25zZS5kYXRhIDogJydcblx0XHRcdFx0XHQpLm1hdGNoKC9zaWRcXDpcXHNcXCdbMC05YS1mXFwuXSsvKTtcblxuXHRcdFx0XHRcdGlmIChyZXN1bHQgJiYgcmVzdWx0WzBdICYmIHJlc3VsdFswXS5sZW5ndGggPiA3KSB7XG5cdFx0XHRcdFx0XHR5YW5kZXhUcmFuc2xhdGVTSUQgPSByZXN1bHRbMF0uc3Vic3RyaW5nKDYpO1xuXHRcdFx0XHRcdFx0eWFuZGV4U0lETm90Rm91bmQgPSBmYWxzZTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0eWFuZGV4U0lETm90Rm91bmQgPSB0cnVlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0fSlcblx0XHRcdFx0LmNhdGNoKChlcnJvcikgPT4ge1xuXHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJlc29sdmUoKTtcblx0XHR9XG5cdH0pLnRoZW4oKCkgPT4geWFuZGV4VHJhbnNsYXRlU0lEKTtcbn1cbiJdfQ==
